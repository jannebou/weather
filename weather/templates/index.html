<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <style>
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; right: 0; left: 0; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"/>
</head>

<body>
    <div id="map" style="width: 100%; height: 100%;">
    <button id="print-button" onclick="printMarkers()">Print Markers</button> <!-- Button to print markers -->
    
    <script>
        var map = L.map('map').setView([62.791668, 22.841667], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        //markerit
        var markers = {};
        var markerCounter = 0;

        // Event listener for click events on the map
        map.on('click', function(e) {
            var lat = e.latlng.lat.toFixed(6);
            var lon = e.latlng.lng.toFixed(6);

            var markerId = markerCounter; // Generate a unique identifier for the marker
            var marker = L.marker([lat, lon]).addTo(map);
            marker.bindPopup('<b>Coordinates:</b><br>Latitude: ' + lat + '<br>Longitude: ' + lon).openPopup();

            //markerin tiedot talteen
            markers[markerId] = {
                lat: lat,
                lon: lon,
                marker: marker
            };

            // Send coordinates to server
            var formData = new FormData();
            formData.append('lat', lat);
            formData.append('lon', lon);
            fetch('/klikkikoordinaatit', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())
            .then(data => {
                console.log(data);
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });

        map.on('popupopen', function(e) {
            var markerId = Object.keys(markers).find(key => markers[key].marker === e.popup._source);
            if (markerId) {
                console.log('Marker ID:', markerId);
                // You can access marker information from markers[markerId] and display it as needed
            }
        });
    
    </script>

</body>

</html>